version: 2
models:
  - name: defi__fact_swaps
    description: Records of all swap transactions on Aleo, including both public and private swaps.
    columns:
      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_row_values_to_have_recent_data:
              datepart: day
              interval: 1
          - not_null

      - name: BLOCK_ID
        description: "{{ doc('block_id') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: TX_ID
        description: "{{ doc('tx_id') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: POOL_ID
        description: "The identifier of the pool used for the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: SWAPPER
        description: "The address that initiated the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: INPUT_AMOUNT
        description: "The amount of tokens input into the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: INPUT_TOKEN_ID
        description: "The identifier of the token being input into the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: OUTPUT_AMOUNT
        description: "The amount of tokens received from the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: OUTPUT_TOKEN_ID
        description: "The identifier of the token received from the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: INVOLVED_PROGRAMS
        description: "Array of programs involved in the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: INVOLVED_FUNCTIONS
        description: "Array of functions involved in the swap"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: FIRST_INDEX
        description: "The first index of the swap within the transaction"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: LAST_INDEX
        description: "The last index of the swap within the transaction"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: IS_PRIVATE
        description: "Boolean indicating if the swap was a private transaction"
        tests:
          - dbt_expectations.expect_column_to_exist
          - accepted_values:
              values: [true, false]
          - not_null

      - name: FACT_SWAPS_ID
        description: '{{ doc("pk") }}'
        tests:
          - unique
          - not_null

      - name: INSERTED_TIMESTAMP
        description: '{{ doc("inserted_timestamp") }}'
        tests:
          - not_null

      - name: MODIFIED_TIMESTAMP
        description: '{{ doc("modified_timestamp") }}'
        tests:
          - not_null