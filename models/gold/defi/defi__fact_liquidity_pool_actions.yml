version: 2
models:
  - name: defi__fact_liquidity_pool_actions
    description: Records of all liquidity pool actions (add/remove liquidity, swaps) on Aleo.
    columns:
      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_row_values_to_have_recent_data:
              datepart: day
              interval: 1
          - not_null
      - name: BLOCK_ID
        description: "{{ doc('block_id') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: TX_ID
        description: "{{ doc('tx_id') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null
      - name: INDEX
        description: "The index of the action within the transaction"
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: FUNCTION
        description: "The type of liquidity pool action (e.g., add_liquidity, remove_liquidity, swap)"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null

      - name: TOKEN1_ID
        description: "The identifier of the first token in the pair"
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: TOKEN2_ID
        description: "The identifier of the second token in the pair"
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: INITIATOR_ADDRESS
        description: "The address that initiated the liquidity pool action"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: TOKEN1_AMOUNT
        description: "The amount of token1 involved in the action"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: TOKEN2_AMOUNT
        description: "The amount of token2 involved in the action"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: LIQUIDITY_PROVIDER
        description: "The address of the liquidity provider"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: LIQUIDITY_POOL_ADDRESS
        description: "The address of the liquidity pool"
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null:
              where: not is_private

      - name: IS_PRIVATE
        description: "Boolean indicating if the action was a private transaction"
        tests:
          - dbt_expectations.expect_column_to_exist
          - accepted_values:
              values: [true, false]

      - name: FACT_LIQUIDITY_POOL_ACTIONS_ARCANE_ID
        description: '{{ doc("pk") }}'
        tests:
          - unique
          - not_null

      - name: INSERTED_TIMESTAMP
        description: '{{ doc("inserted_timestamp") }}'
        tests:
          - not_null

      - name: MODIFIED_TIMESTAMP
        description: '{{ doc("modified_timestamp") }}'
        tests:
          - not_null